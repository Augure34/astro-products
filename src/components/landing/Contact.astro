---
import { getCollection } from "astro:content";

export interface Props {
    itemId: string;
}

const { itemId } = Astro.props;
console.log(Astro.props);
const collections = {
    woodworking: await getCollection("woodworking"),
    gardening: await getCollection("gardening"),
    metalworking: await getCollection("metalworking"),
};
let item: any = null;
if (itemId) {
    for (const [_, collection] of Object.entries(collections)) {
        item = collection.find((entry) => entry.id === itemId);
        if (item) {
            break;
        }
    }
}

const today = new Date().toISOString().split('T')[0];
const twoWeeksFromNow = new Date(Date.now() + 14 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];

---

<div class="contact-form-container bg-gray-900">
    <div class="product-info">
        <h2>Demande de réservation pour: {item.data.name}</h2>
    </div>

    <form id="contactForm">
        <div class="date-picker-container">
            <label for="startDate">Date de début:</label>
            <input
          type="date"
          id="startDate"
          name="startDate"
          class="date-input"
          min={today}
          max={twoWeeksFromNow}
        />

            <label for="dayNumber">Nombre de jours:</label>
            <input
                type="number"
                id="dayNumber"
                name="dayNumber"
                class="date-input"
                min="1"
                value="1"
            />
        </div>
        <label for="name">Nom</label>
        <input type="text" id="name" name="name" required />
        <input type="hidden" name="itemId" value={itemId || ""} />
        <input type="hidden" name="itemName" value={item.data.name || ""} />
        <button type="button" id="sendEmailButton">Send Email</button>
    </form>
</div>

<style>
    .contact-form-container {
        font-family: "Inter", sans-serif;
        color: #1f2937;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        width: 100%;
    }
    h1 {
        font-size: 2.25rem;
        font-weight: 600;
        color: #1e293b;
        margin-bottom: 2rem;
        text-align: center;
    }
    p {
        font-size: 1rem;
        line-height: 1.75rem;
        color: #4b5563;
        margin-bottom: 1rem;
        text-align: center;
    }
    form {
        background-color: #ffffff;
        border-radius: 0.5rem;
        box-shadow:
            0 1px 3px 0 rgba(0, 0, 0, 0.1),
            0 1px 2px -1px rgba(0, 0, 0, 0.1);
        padding: 2rem;
        width: 100%;
        max-width: 600px;
        margin-bottom: 2rem;
    }
    label {
        display: block;
        font-size: 0.875rem;
        font-weight: 600;
        color: #374151;
        margin-bottom: 0.5rem;
    }
    input,
    textarea {
        width: 100%;
        padding: 0.75rem;
        border-radius: 0.375rem;
        border: 1px solid #d1d5db;
        font-size: 1rem;
        margin-bottom: 1rem;
        outline: none;
        box-sizing: border-box;
    }
    input:focus,
    textarea:focus {
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
    }
    textarea {
        resize: vertical;
        min-height: 120px;
    }
    button {
        background-color: #4caf50;
        color: #ffffff;
        padding: 0.75rem 1.5rem;
        border-radius: 0.375rem;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.2s ease;
        width: 100%;
        border: none;
    }
    button:hover {
        background-color: #45a049;
    }
    button:disabled {
        background-color: #b3e5b9;
        cursor: not-allowed;
    }
    .product-info {
        background-color: #e5e7eb;
        padding: 1.5rem;
        border-radius: 0.5rem;
        margin-bottom: 2rem;
        text-align: center;
        width: 100%;
        max-width: 600px;
    }
    .product-info h2 {
        font-size: 1.5rem;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 1rem;
    }
    .product-info p {
        margin-bottom: 0.5rem;
    }
    .message-box {
        margin-top: 1rem;
        padding: 1rem;
        border-radius: 0.375rem;
        text-align: center;
        font-weight: 500;
    }
    .message-box.success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }
    .message-box.error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
    }
    .date-picker-container {
        display: flex;
        flex-direction: column;
    }
    .date-input {
        width: 100%;
        padding: 0.75rem;
        border-radius: 0.375rem;
        border: 1px solid #d1d5db;
        font-size: 1rem;
        margin-bottom: 1rem;
        outline: none;
        box-sizing: border-box;
    }
</style>

<script>
    const sendEmailButton = document.getElementById("sendEmailButton");
    const contactForm = document.getElementById("contactForm");

    if (sendEmailButton && contactForm) {
        sendEmailButton.addEventListener("click", (event) => {
            event.preventDefault();

            const name = contactForm.name.value;
            const startDate = contactForm.startDate?.value;
            const dayNumber = contactForm.dayNumber?.value;
            const itemId = contactForm.itemId.value;
            const itemName = contactForm.itemName.value;

            let body = `Nom: ${name}`;
            if (startDate && dayNumber) {
                body += `\nStart Date: ${startDate}\nNumber of Days: ${dayNumber}`;
            }
            body += `\nItem ID: ${itemId}\nItem Name: ${itemName}`;
            body += `\n-------------Ne rien modifier au dessus de cette ligne----------------`
            body += `\nMessage libre (optionnel):`

            const subject = `Demande de réservation pour ${itemName}`;
            const mailtoLink = `mailto:ghislain.rossi@gmail.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;

            window.open(mailtoLink, "_blank");
        });
    }
</script>
