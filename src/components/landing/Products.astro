---
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import { ToCacheBustable } from "../global/CacheBuster.astro";
Astro.response.headers.set(
  "Cache-Control",
  "public, max-age=31536000, immutable",
);

const collections = {
  Menuiserie: await getCollection("menuiserie"),
  Nettoyage: await getCollection("nettoyage"),
  Jardinage: await getCollection("jardinage"),
  Bricolage: await getCollection("bricolage"),
  Metalurgie: await getCollection("metalurgie"),
  Divers: await getCollection("divers"),
};

Astro.response.headers.set(
  "Cache-Control",
  "public, s-maxage=300, stale-while-revalidate=30",
);
---

<main class="bg-gray-900">
  <div class="relative mx-auto px-8 max-w-7xl py-12 md:px-12">
    <h1 class="text-2xl font-bold text-yellow-600 mb-8 text-center tracking-wider">Location d'outils pour particuliers sur Montpellier</h1>
    {
      Object.entries(collections).map(([collectionName, collectionItems]) => {
        return (
          <div class="mt-8">
            <h1 class="font-semibold text-gray-900 bg-yellow-600 rounded-3xl p-2 m-10 mx-auto text-center max-w-md text-xl">
              {collectionName}
            </h1>
            <div class="grid grid-cols-1 gap-6 lg:gap-y-32 md:grid-cols-2 lg:grid-cols-3">
              {collectionItems.map((item) => (
                <figure
                  data-item={JSON.stringify(item)}
                  class="product-figure flex flex-col"
                >
                  <Image
                    class="w-full rounded-3xl shadow-2xl object-cover aspect-[4/3]"
                    src={ToCacheBustable(item.data.image)}
                    alt={item.data.name}
                    width={400}
                    height={300}
                  />
                  <div class="mt-4 px-6 flex-grow flex flex-col">
                    <div class="flex-grow">
                      <h2 class="mt-1 font-medium leading-6 text-yellow-600 text-2xl text-center mb-4">
                        {item.data.name}
                      </h2>
                      <p class="mt-1 text-lg font-medium leading-6 text-white">
                        {item.data.description}
                      </p>
                      <div class="flex justify-between">
                        <div>
                          <p class="mt-2 text-sm text-gray-400">
                            Marque: {item.data.manufacturer}
                          </p>
                          <p class="mt-1 text-sm text-gray-400">
                            Modèle: {item.data.model}
                          </p>
                        </div>
                        <div>
                          <p class="text-sm text-yellow-600 mt-2 text-right">
                            Journée: {item.data.price.daily}€
                          </p>
                          <p class="text-sm text-yellow-600 mt-1 text-right">
                            Semaine: {item.data.price.weekly}€
                          </p>
                        </div>
                      </div>
                    </div>
                    <div class="flex space-x-2 justify-end mt-4">
                      {item.data.manual && (
                        <a
                          href={item.data.manual}
                          target="_blank"
                          class="w-1/3 rounded-md bg-gray-400 text-black py-2 font-semibold hover:bg-yellow-600 transition-colors duration-200 text-center block"
                        >
                          Ma notice
                        </a>
                      )}
                      <a
                        href={`/${item.id}`}
                        class={` ${
                          item.data.manual ? "w-2/3" : "w-full"
                        } rounded-md bg-yellow-500 text-black py-2 font-semibold hover:bg-yellow-600 transition-colors duration-200 text-center block`}
                      >
                        Me réserver
                      </a>
                    </div>
                  </div>
                </figure>
              ))}
            </div>
          </div>
        );
      })
    }
  </div>
</main>
